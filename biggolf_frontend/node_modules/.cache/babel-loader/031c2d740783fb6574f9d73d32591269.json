{"ast":null,"code":"\"use strict\";\n\nfunction dePalette(indata, outdata, width, height, palette) {\n  let pxPos = 0;\n  // use values from palette\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let color = palette[indata[pxPos]];\n      if (!color) {\n        throw new Error(\"index \" + indata[pxPos] + \" not in palette\");\n      }\n      for (let i = 0; i < 4; i++) {\n        outdata[pxPos + i] = color[i];\n      }\n      pxPos += 4;\n    }\n  }\n}\nfunction replaceTransparentColor(indata, outdata, width, height, transColor) {\n  let pxPos = 0;\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let makeTrans = false;\n      if (transColor.length === 1) {\n        if (transColor[0] === indata[pxPos]) {\n          makeTrans = true;\n        }\n      } else if (transColor[0] === indata[pxPos] && transColor[1] === indata[pxPos + 1] && transColor[2] === indata[pxPos + 2]) {\n        makeTrans = true;\n      }\n      if (makeTrans) {\n        for (let i = 0; i < 4; i++) {\n          outdata[pxPos + i] = 0;\n        }\n      }\n      pxPos += 4;\n    }\n  }\n}\nfunction scaleDepth(indata, outdata, width, height, depth) {\n  let maxOutSample = 255;\n  let maxInSample = Math.pow(2, depth) - 1;\n  let pxPos = 0;\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      for (let i = 0; i < 4; i++) {\n        outdata[pxPos + i] = Math.floor(indata[pxPos + i] * maxOutSample / maxInSample + 0.5);\n      }\n      pxPos += 4;\n    }\n  }\n}\nmodule.exports = function (indata, imageData) {\n  let skipRescale = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  let depth = imageData.depth;\n  let width = imageData.width;\n  let height = imageData.height;\n  let colorType = imageData.colorType;\n  let transColor = imageData.transColor;\n  let palette = imageData.palette;\n  let outdata = indata; // only different for 16 bits\n\n  if (colorType === 3) {\n    // paletted\n    dePalette(indata, outdata, width, height, palette);\n  } else {\n    if (transColor) {\n      replaceTransparentColor(indata, outdata, width, height, transColor);\n    }\n    // if it needs scaling\n    if (depth !== 8 && !skipRescale) {\n      // if we need to change the buffer size\n      if (depth === 16) {\n        outdata = Buffer.alloc(width * height * 4);\n      }\n      scaleDepth(indata, outdata, width, height, depth);\n    }\n  }\n  return outdata;\n};","map":{"version":3,"names":["dePalette","indata","outdata","width","height","palette","pxPos","y","x","color","Error","i","replaceTransparentColor","transColor","makeTrans","length","scaleDepth","depth","maxOutSample","maxInSample","Math","pow","floor","module","exports","imageData","skipRescale","colorType","Buffer","alloc"],"sources":["C:/Users/Daniel/node_modules/appium/node_modules/pngjs/lib/format-normaliser.js"],"sourcesContent":["\"use strict\";\n\nfunction dePalette(indata, outdata, width, height, palette) {\n  let pxPos = 0;\n  // use values from palette\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let color = palette[indata[pxPos]];\n\n      if (!color) {\n        throw new Error(\"index \" + indata[pxPos] + \" not in palette\");\n      }\n\n      for (let i = 0; i < 4; i++) {\n        outdata[pxPos + i] = color[i];\n      }\n      pxPos += 4;\n    }\n  }\n}\n\nfunction replaceTransparentColor(indata, outdata, width, height, transColor) {\n  let pxPos = 0;\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let makeTrans = false;\n\n      if (transColor.length === 1) {\n        if (transColor[0] === indata[pxPos]) {\n          makeTrans = true;\n        }\n      } else if (\n        transColor[0] === indata[pxPos] &&\n        transColor[1] === indata[pxPos + 1] &&\n        transColor[2] === indata[pxPos + 2]\n      ) {\n        makeTrans = true;\n      }\n      if (makeTrans) {\n        for (let i = 0; i < 4; i++) {\n          outdata[pxPos + i] = 0;\n        }\n      }\n      pxPos += 4;\n    }\n  }\n}\n\nfunction scaleDepth(indata, outdata, width, height, depth) {\n  let maxOutSample = 255;\n  let maxInSample = Math.pow(2, depth) - 1;\n  let pxPos = 0;\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      for (let i = 0; i < 4; i++) {\n        outdata[pxPos + i] = Math.floor(\n          (indata[pxPos + i] * maxOutSample) / maxInSample + 0.5\n        );\n      }\n      pxPos += 4;\n    }\n  }\n}\n\nmodule.exports = function (indata, imageData, skipRescale = false) {\n  let depth = imageData.depth;\n  let width = imageData.width;\n  let height = imageData.height;\n  let colorType = imageData.colorType;\n  let transColor = imageData.transColor;\n  let palette = imageData.palette;\n\n  let outdata = indata; // only different for 16 bits\n\n  if (colorType === 3) {\n    // paletted\n    dePalette(indata, outdata, width, height, palette);\n  } else {\n    if (transColor) {\n      replaceTransparentColor(indata, outdata, width, height, transColor);\n    }\n    // if it needs scaling\n    if (depth !== 8 && !skipRescale) {\n      // if we need to change the buffer size\n      if (depth === 16) {\n        outdata = Buffer.alloc(width * height * 4);\n      }\n      scaleDepth(indata, outdata, width, height, depth);\n    }\n  }\n  return outdata;\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}